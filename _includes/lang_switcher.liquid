{% for lang in site.languages %}
  {% assign lang_full = site.data.locales[lang].lang_full %}
  {% if lang == site.active_lang %}
    <span class="active">{{ lang_full }}</span>
  {% else %}
    {%- comment -%}
    Use page.permalink (not page.url) to avoid language prefix duplication
    Wrap with static_href to prevent Polyglot URL relativization
    {%- endcomment -%}
    {% capture lang_url %}
      {{ site.baseurl }}/{% if lang != site.default_lang %}{{ lang }}/{% endif %}{{ page.permalink | remove_first: '/' }}
    {% endcapture %}
    <a {% static_href %}href="{{ lang_url | strip }}"{% endstatic_href %} hreflang="{{ lang }}">{{ lang_full }}</a>
  {% endif %}
  {% unless forloop.last %} | {% endunless %}
{% endfor %}
